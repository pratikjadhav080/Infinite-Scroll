<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./index.css">
    <title>Document</title>
</head>
<body>
    <div class="container">
        
    </div>
</body>
<script>

    let i = 0;

    const main = document.querySelector(".container");

    const consoleSomething = () => {
        console.log("Throttle ", i++);
    }

    const throttle = (func, limit) => {
        let flag = true;
        return () => {
            if (flag) {
                func();
                flag = false;
                setTimeout(() => {
                    flag = true
                }, limit);
            }
        }
    }

    const showSomething = throttle(consoleSomething, 2000)

    const showData = (data) => {
        data.forEach(({urls:{regular}}) => {
            let img = document.createElement("img");
            img.src = regular;
            img.addEventListener("click", showSomething)
            main.appendChild(img);
        })
    }

    let page = 1;

    const getData = async (page) => {
        const response = await fetch(`https://api.unsplash.com/search/photos?client_id=1_mZ7KFa6sDdUAKLf3npFtX5ASyCft4qo3E7dkPVKyw&page=${page}&per_page=25&query=nature`);

        const {results} = await response.json();

        showData(results);
    }
    getData()

    window.addEventListener("scroll", () => {
        if (window.scrollY + window.innerHeight >= document.documentElement.scrollHeight) {
            getData(page++);
        }
    })
    
</script>
</html>